- name: Add a VMware vSwitch without any physical NIC attached
  community.vmware.vmware_vswitch:
    hostname: '{{ esxi_hostname }}'
    username: '{{ esxi_username }}'
    password: '{{ esxi_password }}'
    switch: protected
    mtu: 1500
    security:
      allow_promiscuous: true
      mac_changes: true
      forged_transmits: true
  delegate_to: localhost

- name: Add Portgroup with all settings defined
  community.vmware.vmware_portgroup:
    username: "{{ esxi_username }}"
    password: "{{ esxi_password }}"
    switch: "protected"
    portgroup: "protected"
    security:
        promiscuous_mode: true
        mac_changes: true
        forged_transmits: true